# Инструкции за студентите — setup, workflow и именуване на клонове

Тези инструкции ще ви помогнат да настроите работна среда, 
да работите върху задачите, да пускате тестовете локално и да изпратите вашето решение така, 
че CI (GitHub Actions) да го оцени автоматично.

> Отворете Windows PowerShell като администратор и стартирайте setup-class-windows.ps1 за да инсталирате всичко необходимо за работа
> форкнете/клонирайте репото, работете от клона `vulnerable`, 
> създайте клон `student_<име>_fixed` (или `student_<id>_fixed`), 
> фиксирайте уязвимостите в `fixed/taskN/`, 
> пуснете тестовете локално и направете PR към основното репо (или към вашия fork). 
> CI ще отбележи дали уязвимостите са премахнати.

---

## 1. Какво съдържа репото

* `vulnerable/taskN/` — уязвим вариант (изходен код).
* `fixed/taskN/` — място за вашите поправки (по подразбиране съдържа примерно „fixed“; задачата е да го модифицирате или замените).
* `tests/` — `functional` и `vuln` тестове за всяка задача.
* `.github/workflows/` — GitHub Actions workflow: ci стартира тестовете.

---

## 2. Общ препоръчителен workflow

1. **Fork & Clone (препоръчително)**

   * Форкнете основното репо в своя GitHub акаунт 
   (ако работите в курса — може да работите директно в предоставеното от преподавателя репо според инструкциите му).
   * Клонирайте:

     ```
     git clone https://github.com/<your-username>/secure-coding-exercises.git
     cd secure-coding-exercises
     ```

2. **Създайте виртуална среда и инсталирайте зависимости**

   ```
   python -m venv .venv
   .venv\Scripts\activate
   python.exe -m pip install --upgrade pip
   pip install -r requirements.txt
   ```

3. **Работете винаги от клона `vulnerable` като изходна точка**

   ```
   git checkout vulnerable        # ако няма — създайте/изберете според инструкциите на преподавателя
   git pull origin vulnerable
   ```

4. **Създайте ваш студентски клон (пример)**

   * Формат: `student_<име>_fixed` (напр. `student_alex_fixed` или `student_12345_fixed`).
   
   ```
   git checkout -b student_alex_fixed
   ```

   Работете в този клон и правете commits.

5. **Къде да внасяте промените**

   * Поправките трябва да са в `fixed/taskN/...`. Например, ако поправяте SQLi (task1), 
   променете `fixed/task1/app.py` така че тестовете да показват, че уязвимостта е премахната.
   * **Не модифицирайте тестовете** (`tests/`) — CI използва тестовете да валидира решенията.

6. **Пускайте локално тестовете често**

   * Пуснете всички функционални тестове:

     ```
     pytest -q tests/*
     ```

     Функционалните тестове трябва да минават и за `vulnerable`, и за `fixed` 
   (те проверяват основната функционалност).
   * Проверете vuln-тестовете (локално):
     При `fixed` (вашия клон `student_..._fixed`) CI очаква vuln-тестовете да **не минават** 
     (или branch expectations да потвърдят, че уязвимостта е премахната).

7. **Commit и Push**

   ```
   # пример
   git commit -m "Fix: task1 SQL injection by parameterized queries"
   git push origin student_alex_fixed
   ```

8. **Отворете Pull Request (PR)**

   * В GitHub направете PR от вашия `student_<имe>_fixed` (fork) към основния репо `main` 
   (или към инструктора/съдържателя на курса, според инструкциите).

---

## 3. Именуване на клоновете (много важно)

* **Строгото правило за автоматично оценяване** (препоръчително):

  * `student_<уредено_име>_fixed` — CI ще третира като **fixed** (очиаква уязвимостите да са премахнати).
  * Пример: `student_john_fixed`, `student_12345_fixed`.

---

## 4. Често срещани проблеми и отстраняване

* **„Vuln tests“ все още минават на вашия fixed клон** — вероятно не сте поправили уязвимостта или тестът проверява друг файл/функция. Прочетете внимателно `tests/vuln_taskN.py` и `tools/branch_expectations.py`.
* **Functional тестове не минават** — спрете и оправете функционалността, преди да пускате vuln-tests.
* **CI показва грешка „branch must be exactly 'vulnerable' or 'fixed'“** — това е за строг workflow; използвайте студентски workflow (имена `student_*_fixed`) или именувайте клона `fixed`/`vulnerable`.
* **Локални различия (други версии на пакети)** — използвайте виртуална среда и `requirements.txt`. Ако имате проблеми със специфична библиотека, питайте преподавателя/асистента.

---

## 5. Съвети за безопасност

* Тестовете могат да създават временни файлове под `/tmp` — това е нормално. Не изпращайте експлойти към публични системи. Всички опасни операции са изолирани за учебни цели.
* Ако използвате собствена машина, не давайте CI или тестовете права, които не желаете — използвайте контейнер/Docker при несигурност.

---

## 6. Пример — бърза сесия (минимален набор команди)

```bash
# 1. Клониране
git clone https://github.com/<your-username>/secure-coding-exercises.git
cd secure-coding-exercises

# 2. Виртуална среда
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt

# 3. Започнете от vulnerable
git checkout vulnerable

# 4. Създайте свой клон
git checkout -b student_<yourname>_fixed

# 5. Поправете нужните файлове в fixed/taskN/
# 6. Пуснете тестове локално
pytest -q tests/*

# 7. Качете и направете PR
git commit -m "Fix task1: parameterize SQL queries"
git push origin student_<yourname>_fixed
# После направете PR през GitHub
```

---

## 7. Ако имате въпроси

* Предложете шаблон за commit messages (напр. `Fix(task1): prevent SQL injection by parameterized queries`).
* Ако нещо в CI изглежда странно — включете логовете от действията в PR и отбележете асистент/преподавател.
* Можете да добавяте собствени unit тестове в `tests/` (добра практика) — но **не изменяйте** съществуващите `tests/vuln_*` 
(те се използват за оценяване).

---
